lang en_us.UTF-8
graphical
install
eula --agreed
auth --enableshadow --passalgo=sha512
cdrom
firstboot --enabled
clearpart --all --initlabel
part /boot --fstype ext4 --size=500
part swap --size=1024
part / --fstype ext4 --size=13480 --grow --asprimary
keyboard us
rootpw --iscrypted $6$bNjXyviGZwK4X3yA$51rtDgkzad9CVE5KkRAltkQSiXoLJxY46oLLURaJ2mVcKEbDsf1tR3BmKQrk8hKS2fBerlBajBjGHXDBQRH261
network --bootproto=dhcp
bootloader --append=" crashkernel=auto" --location=mbr
timezone Asia/Kolkata --isUtc
repo --name=C7.0.1406-base --baseurl="http://vault.centos.org/7.0.1406/os/x86_64/"
%packages
NetworkManager
bash
centos-release
%end
user --name=root --gecos="root" --homedir=/root --password=$6$AIiDNWaAtAAbxkrZ$gmlfzz62t8ICZp1EnrL0cGk65DM6JkaXEIiRyvIWS9Dg15D0BZtKu0JqYEXZnqZ32FfrbTEYa4aqA0KzOgQoZ. --iscrypted --shell=/bin/bash --uid=0 --gid=0
group --name=audio --gid=63
services --enabled=sshd,NetworkManager,tuned
services --disabled=rsyncd,wpa_supplicant,systemd-nspawn@
%pre 
sed -n '/.*inst.ks\?=\([^ ]*\)\/.*[^\s]*/s//\1/p' /proc/cmdline > /tmp/description_url 
%end
%post --nochroot --log=/mnt/sysimage/root/post-install.log
rm -rf '/etc/deleted config'
mkdir -p '/mnt/sysimage/etc'
curl -o '/mnt/sysimage/etc/cron tab' "`cat /tmp/description_url`/changed_config_files/etc/cron%20tab"
chmod 644 '/mnt/sysimage/etc/cron tab'
chown root:root '/mnt/sysimage/etc/cron tab'
rm -rf '/mnt/sysimage/etc/replaced_by_link'
ln -s '/tmp/foo' '/mnt/sysimage/etc/replaced_by_link'
chown --no-dereference root:target '/mnt/sysimage/etc/replaced_by_link'
chmod 755 '/mnt/sysimage/etc/somedir'
chown user:group '/mnt/sysimage/etc/somedir'
rm -rf '/etc/deleted changed managed'
rm -rf '/mnt/sysimage/usr/bin/replaced_by_link'
ln -s '/tmp/foo' '/mnt/sysimage/usr/bin/replaced_by_link'
chown --no-dereference root:target '/mnt/sysimage/usr/bin/replaced_by_link'
mkdir -p '/mnt/sysimage/etc/cron.daily'
curl -o '/mnt/sysimage/etc/cron.daily/cleanup' "`cat /tmp/description_url`/changed_managed_files/etc/cron.daily/cleanup"
chmod 644 '/mnt/sysimage/etc/cron.daily/cleanup'
chown user:group '/mnt/sysimage/etc/cron.daily/cleanup'
mkdir -p '/mnt/sysimage/etc/cron.daily'
curl -o '/mnt/sysimage/etc/cron.daily/logrotate' "`cat /tmp/description_url`/changed_managed_files/etc/cron.daily/logrotate"
chmod 644 '/mnt/sysimage/etc/cron.daily/logrotate'
chown user:group '/mnt/sysimage/etc/cron.daily/logrotate'
chmod 644 '/mnt/sysimage/etc/cron.d'
chown user:group '/mnt/sysimage/etc/cron.d'
curl -o '/mnt/sysimage/tmp/filter' "`cat /tmp/description_url`/unmanaged_files_kickstart_excludes"
curl -o '/mnt/sysimage/tmp/files.tgz' "`cat /tmp/description_url`/unmanaged_files/files.tgz"
tar -C /mnt/sysimage/ -X '/mnt/sysimage/tmp/filter' -xf '/mnt/sysimage/tmp/files.tgz'
rm '/mnt/sysimage/tmp/files.tgz'
curl -o '/mnt/sysimage/tmp/tarball with spaces.tgz' "`cat /tmp/description_url`/unmanaged_files/trees/etc/tarball%20with%20spaces.tgz"
tar -C /mnt/sysimage/ -X '/mnt/sysimage/tmp/filter' -xf '/mnt/sysimage/tmp/tarball with spaces.tgz'
rm '/mnt/sysimage/tmp/tarball with spaces.tgz'
%end
